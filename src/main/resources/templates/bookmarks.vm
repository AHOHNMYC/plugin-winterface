#set( $bookmarkEditorPath = $winterface-routes.getPathFor("Bookmarks") )

<div class=" 
	#if( $requestedPage == $winterface-routes.getFullPathTemplateFor("Bookmarks") )span12
	#else
		#if( $freenet.getValidAlertCount() > 0 )span8#{else}span12#end
	#end
	" id="bookmarks-container">
    <section class="nopadding">
      <div class="page-header">
        <span class="lead">$i18n.get("Global.BookmarksTitle")</span>  
		#if( $requestedPage != $winterface-routes.getFullPathTemplateFor("Bookmarks") )
			<a class="btn btn-small btn-link" href="$winterface-routes.getPathFor("Bookmarks")" id="edit-bookmarks"><i class="icon-edit"></i>$i18n.get("Global.EditAction")</a>
		#end
	  </div>

      <div class="accordion" id="bookmark-list">
      #foreach( $cat in $freenet.getBookmarkCategories() )
		#set( $categoryCount = $velocityCount )
		<div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#bookmark-list" href="#bmcollapse$velocityCount">
              $cat.getVisibleName()
            </a>
          </div>
          <div id="bmcollapse$velocityCount" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul>
              #foreach( $item in $freenet.getBookmarksFromCat($cat) )
                <li>
					##FIXME Dirty hack for updated bookmark status
					#if( $item.getUpdatedStatus() )
						<span class="icon-info-sign"></span>
						<script>$("[id=bmcollapse$categoryCount]").collapse('show');</script>
					#end
					#set( $itemPath = $freenet.getBookmarkItemPathEncoded($cat.getCatPath(), $item) )
					<a id="bmPop$velocityCount" href="/$item.getKey()" target="_blank" data-trigger="manual" data-original-title="$i18n.get("Bookmarks.popover.edit")" rel="bkPopover" data-container="#bookmark-list" data-placement="left" data-html="true"
					data-content="<a href'$bookmarkEditorPath/?action=up&bookmark=$itemPath'><i class='icon-edit'></i>$i18n.get('Global.EditAction')</a> <a href='$bookmarkEditorPath/?action=del&bookmark=$itemPath'><i class='icon-trash'></i>$i18n.get('Global.DeleteAction')</a>
					<br>#if( $velocityCount != 1 )<a href='$bookmarkEditorPath/?action=up&bookmark=$itemPath'><i class='icon-arrow-up'></i>$i18n.get('Global.UpAction')</a> #end#if( $velocityCount != $freenet.getBookmarksFromCatCount($cat) )<a href='$bookmarkEditorPath/?action=down&bookmark=$itemPath'<i class='icon-arrow-down'></i>$i18n.get('Global.DownAction')</a>#end"
					>$item.getVisibleName()</a> $item.getShortDescription()
				</li>
              #end  
              </ul>
            </div>
		  </div>
        </div>
	  #end

	  #if( $requestedPage == $winterface-routes.getFullPathTemplateFor("Bookmarks") )
	  <script>  
	  	$("[id^=bmcollapse]").collapse('show');
        $('a[rel=bkPopover]').popover().on("mouseenter", function () {
        	var _this = this;
        	$(this).popover("show");
        	$(".popover").on("mouseleave", function () {
            	$(_this).popover('hide');
        	});
        }).on("mouseleave", function () {
        	var _this = this;
        	setTimeout(function () {
            	if (!$(".popover:hover").length) {
                	$(_this).popover("hide")
            	}
        	}, 100);
        });
	  </script>
	  #end
	  </div>
    </section>
</div>