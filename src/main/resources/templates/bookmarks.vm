#set( $bookmarkEditorPath = $winterface-routes.getPathFor("Bookmarks") )

<div class=" 
	#if( $requestedPage == $winterface-routes.getFullPathTemplateFor("Bookmarks") )span12
	#else
		#if( $freenet.getValidAlertCount() > 0 )span8#{else}span12#end
	#end
	" id="bookmarks-container">
    <section class="nopadding">
      <div class="page-header">
        <span class="lead">$i18n.get("Global.BookmarksTitle")</span>  
		#if( $requestedPage != $winterface-routes.getFullPathTemplateFor("Bookmarks") )
			<a class="btn btn-small btn-link" href="$winterface-routes.getPathFor("Bookmarks")" id="edit-bookmarks"><i class="icon-edit"></i>$i18n.get("Global.EditAction")</a>
		#end
	  </div>

      <div class="accordion" id="bookmark-list">
      #foreach( $cat in $freenet.getBookmarkCategories() )
		#set( $categoryCount = $velocityCount )
		<div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#bookmark-list" href="#bmcollapse$velocityCount">
              $cat.getVisibleName()
            </a>
          </div>
          <div id="bmcollapse$velocityCount" class="accordion-body collapse">
            <div class="accordion-inner">
              <ul>
              #foreach( $item in $freenet.getBookmarksFromCat($cat) )
                <li>
					#if( $item.getUpdatedStatus() )
						<span class="icon-info-sign"></span>
						<script>$("[id=bmcollapse$categoryCount]").collapse('show');</script>
					#end
					#set( $itemPath = $freenet.getBookmarkItemPathEncoded($cat.getCatPath(), $item) )
					<a id="bmPop$velocityCount" href="/$item.getKey()" target="_blank" data-trigger="manual" data-original-title="$i18n.get("Bookmarks.popover.edit")" rel="bkPopover" data-container="#bookmark-list" data-placement="left" data-html="true"
					data-content="<a href='#editBookmarkItem$categoryCount$velocityCount' data-toggle='modal'><i class='icon-edit'></i>$i18n.get('Global.EditAction')</a> <a href='#deleteBookmarkItem$categoryCount$velocityCount' data-toggle='modal'><i class='icon-trash'></i>$i18n.get('Global.DeleteAction')</a>
					<br>#if( $velocityCount != 1 )<a href='$bookmarkEditorPath/?action=up&bookmark=$itemPath'><i class='icon-arrow-up'></i>$i18n.get('Global.UpAction')</a> #end#if( $velocityCount != $freenet.getBookmarksFromCatCount($cat) )<a href='$bookmarkEditorPath/?action=down&bookmark=$itemPath'<i class='icon-arrow-down'></i>$i18n.get('Global.DownAction')</a>#end"
					>$item.getVisibleName()</a> $item.getShortDescription()
				</li>
				
				#if( $requestedPage == $winterface-routes.getFullPathTemplateFor("Bookmarks") )
    			  <!-- Modal Delete BookmarkItem -->
    			  <!-- //FIXME Category 1 Bookmark 11 == Category 11 Bookmark 1
    			  		Find a way to place something in between category and velocity count and still have them parced by velocity -->
                  <div id="deleteBookmarkItem$categoryCount$velocityCount" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="deleteBookmarkItem" aria-hidden="true">
                	<div class="modal-header">
                		<h3>Delete Bookmark</h3>
                	</div>
                	<div class="modal-body">
                		<p>$i18n.get('Bookmarks.delete.body') $item.getVisibleName()?</p>
                	</div>
                	<div class="modal-footer">
                		<a class="btn" data-dismiss="modal" aria-hidden="true">$i18n.get('Global.CancelAction')</a>
                		<a href="$bookmarkEditorPath/?action=del&bookmark=$itemPath" class="btn btn-danger">$i18n.get('Global.DeleteAction')</a>
                	</div>
                  </div>
    			  
    			  <!-- Modal Edit BookmarkItem -->
                  <div id="editBookmarkItem$categoryCount$velocityCount" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="deleteBookmarkItem" aria-hidden="true">
    			  <form accept-charset="utf-8" method="post" action="?action=edit&bookmark=$itemPath">
                      <fieldset>
            			<div class="modal-header">
            				<h3>Edit Bookmark</h3>
            			</div>
            			<div class="modal-body">
            				<label>$i18n.get('Bookmarks.edit.nameLabel'):</label><input name="name" type="text" value="$item.getVisibleName()" style="width: 95%;" required="" autofocus="">
            				<label>$i18n.get('Bookmarks.edit.keyLabel'):</label><input name="key" type="text" value="$item.getKey()" style="width: 95%;" required="">        			
                            $i18n.get('Bookmarks.edit.descBLabel')<br><textarea name="descB" rows="3" style="width: 95%;">$item.getDescription()</textarea>        			
                            $i18n.get('Bookmarks.edit.explainLabel')<br><textarea name="explain" rows="3" style="width: 95%;">$item.getShortDescription()</textarea>
    						$i18n.get('Bookmarks.edit.hasAnActivelinkLabel') <input type="checkbox" name="hasAnActivelink" #if( $item.hasAnActivelink() )checked#end>
    					</div>
            			<div class="modal-footer">
            				<a class="btn" data-dismiss="modal" aria-hidden="true">$i18n.get('Global.CancelAction')</a>
            				<button class="btn btn-primary" type="submit">$i18n.get('Global.SaveAction')</button>
            			</div>
            		  </fieldset>
    			  </form>
                  </div>
				#end
			  
              #end  
              </ul>
            </div>
		  </div>
        </div>
	  #end
	  
	  #if( $requestedPage == $winterface-routes.getFullPathTemplateFor("Bookmarks") )
    	  <script>  
    	  	$("[id^=bmcollapse]").collapse('show');
            $('a[rel=bkPopover]').popover().on("mouseenter", function () {
            	var _this = this;
            	$(this).popover("show");
            	$(".popover").on("mouseleave", function () {
                	$(_this).popover('hide');
            	});
            }).on("mouseleave", function () {
            	var _this = this;
            	setTimeout(function () {
                	if (!$(".popover:hover").length) {
                    	$(_this).popover("hide")
                	}
            	}, 100);
            });
    	  </script>
	  #end
	  
	  </div>
    </section>
</div>